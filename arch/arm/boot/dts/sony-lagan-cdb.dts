#include "qcom-apq8064.dtsi"
#include <dt-bindings/interrupt-controller/arm-gic.h>
#include <dt-bindings/soc/qcom,gsbi.h>

#include <dt-bindings/pinctrl/qcom,pm8xxx-gpio.h>
#include <dt-bindings/soc/qcom,rpm.h>
#include <dt-bindings/input/input.h>

/ {
	model = "Sony Lagan CDB";
	compatible = "qcom,apq8064";
	interrupt-parent = <&intc>;

	soc {
		msmgpio: pinctrl@800000 {
			pinctrl-names = "default";
			pinctrl-0 = <&debug_uart>;

			debug_uart: debug_uart {
				mux {
					pins = "gpio51", "gpio52";
					function = "gsbi5";
				};

				tx {
					pins = "gpio51";
					drive-strength = <4>;
					bias-disable;
				};

				rx {
					pins = "gpio52";
					drive-strength = <2>;
					bias-pull-up;
				};
			};

			gsbi1_i2c_active: gsbi1_i2c {
				mux {
					pins = "gpio20", "gpio21";
					function = "gsbi1";
				};

				data {
					pins = "gpio20";
					drive-strengh = <2>;
					bias-disable;
				};

				clk {
					pins = "gpio21";
					drive-strength = <2>;
					bias-disable;
				};
			};

			gsbi2_i2c_active: gsbi2_i2c {
				mux {
					pins = "gpio24", "gpio25";
					function = "gsbi2";
				};

				data {
					pins = "gpio24";
					drive-strengh = <2>;
					bias-disable;
				};

				clk {
					pins = "gpio25";
					drive-strength = <2>;
					bias-disable;
				};
			};

			sdc1_active: sdc1_active {
				clk {
					pins = "sdc1_clk";
					drive-strengh = <16>;
					bias-disable;
				};

				cmd {
					pins = "sdc1_cmd";
					drive-strengh = <10>;
					bias-pull-up;
				};

				data {
					pins = "sdc1_data";
					drive-strengh = <10>;
					bias-pull-up;
				};
			};

			sdc3_active: sdc3_active {
				clk {
					pins = "sdc3_clk";
					drive-strengh = <8>;
					bias-disable;
				};

				cmd {
					pins = "sdc3_cmd";
					drive-strengh = <8>;
					bias-pull-up;
				};

				data {
					pins = "sdc3_data";
					drive-strengh = <8>;
					bias-pull-up;
				};
			 };

			sdc3_cd: sdc3_cd {
				pin {
					pins = "gpio26";
					function = "gpio";

					drive-strength = <2>;
					bias-pull-up;
				};
			};
		};

		gsbi1 {
			compatible = "qcom,gsbi-v1.0.0";
			reg = <0x12460000 0x100>;
			clocks = <&gcc GSBI1_H_CLK>;
			clock-names = "iface";
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			qcom,mode = <GSBI_PROT_I2C_UART>;

			i2c@12460000 {
				compatible = "qcom,i2c-qup-v1.1.1";
				reg = <0x12460000 0x1000>;
				interrupts = <0 194 0>;

				clocks = <&gcc GSBI1_QUP_CLK>, <&gcc GSBI1_H_CLK>;
				clock-names = "core", "iface";

				clock-frequency = <355000>;

				#address-cells = <1>;
				#size-cells = <0>;

				pinctrl-names = "default";
				pinctrl-0 = <&gsbi1_i2c_active>;
			};
		};

		gsbi2 {
			compatible = "qcom,gsbi-v1.0.0";
			reg = <0x124a0000 0x100>;
			clocks = <&gcc GSBI2_H_CLK>;
			clock-names = "iface";
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			qcom,mode = <GSBI_PROT_I2C_UART>;

			i2c@124a0000 {
				compatible = "qcom,i2c-qup-v1.1.1";
				reg = <0x124a0000 0x1000>;
				interrupts = <0 196 0>;

				clocks = <&gcc GSBI2_QUP_CLK>, <&gcc GSBI2_H_CLK>;
				clock-names = "core", "iface";

				clock-frequency = <355000>;

				#address-cells = <1>;
				#size-cells = <0>;

				pinctrl-names = "default";
				pinctrl-0 = <&gsbi2_i2c_active>;
			};
		};

		gsbi5 {
			compatible = "qcom,gsbi-v1.0.0";
			reg = <0x1a200000 0x100>;
			clocks = <&gcc GSBI5_H_CLK>;
			clock-names = "iface";
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			qcom,mode = <GSBI_PROT_I2C_UART>;

			serial@1a040000 {
				compatible = "qcom,msm-uartdm-v1.3", "qcom,msm-uartdm";
				reg = <0x1a240000 0x1000>,
				      <0x1a200000 0x1000>;
				interrupts = <0 154 0x0>;
				clocks = <&gcc GSBI5_UART_CLK>, <&gcc GSBI5_H_CLK>;
				clock-names = "core", "iface";
			};
		};

		amba {
			compatible = "arm,amba-bus";
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			sdcc1: sdcc@12400000 {
				compatible      = "arm,pl18x", "arm,primecell";
				arm,primecell-periphid = <0x00051180>;
				reg             = <0x12400000 0x8000>;
				interrupts      = <GIC_SPI 104 IRQ_TYPE_LEVEL_HIGH>;
				interrupt-names = "cmd_irq";
				clocks          = <&gcc SDC1_CLK>, <&gcc SDC1_H_CLK>;
				clock-names     = "mclk", "apb_pclk";
				bus-width       = <8>;
				max-frequency   = <192000000>;
				non-removable;
				cap-sd-highspeed;
				cap-mmc-highspeed;
				vmmc-supply = <&pm8921_l5>;

				pinctrl-names = "default";
				pinctrl-0 = <&sdc1_active>;
			};

			sdcc3: sdcc@12180000 {
				compatible      = "arm,pl18x", "arm,primecell";
				arm,primecell-periphid = <0x00051180>;
				status = "NO!";
				reg             = <0x12180000 0x8000>;
				interrupts      = <GIC_SPI 102 IRQ_TYPE_LEVEL_HIGH>;
				interrupt-names = "cmd_irq";
				clocks          = <&gcc SDC3_CLK>, <&gcc SDC3_H_CLK>;
				clock-names     = "mclk", "apb_pclk";
				bus-width       = <4>;
				cap-sd-highspeed;
				cap-mmc-highspeed;
				max-frequency   = <192000000>;
				no-1-8-v;
				vmmc-supply = <&pm8921_l6>;
				vqmmc-supply = <&pm8921_l7>;

				pinctrl-names = "default";
				pinctrl-0 = <&sdc3_active &sdc3_cd>;
			};
		};

		rpm {
			compatible = "qcom,rpm-apq8064";
			reg = <0x108000 0x1000 0x2011008 0x4>;

			interrupts = <0 19 0>, <0 21 0>, <0 22 0>;
			interrupt-names = "ack", "err", "wakeup";

			#address-cells = <1>;
			#size-cells = <0>;

			pm8921_l5: pm8921-l5 {
				compatible = "qcom,rpm-pm8921-pldo";
				reg = <QCOM_RPM_PM8921_L5>;

				regulator-min-microvolt = <2950000>;
				regulator-max-microvolt = <2950000>;

				bias-pull-down;
			};

			pm8921_l6: pm8921-l6 {
				compatible = "qcom,rpm-pm8921-pldo";
				reg = <QCOM_RPM_PM8921_L6>;

				regulator-min-microvolt = <2950000>;
				regulator-max-microvolt = <2950000>;

				bias-pull-down;
			};

			pm8921_l7: pm8921-l7 {
				compatible = "qcom,rpm-pm8921-pldo";
				reg = <QCOM_RPM_PM8921_L7>;

				regulator-min-microvolt = <1850000>;
				regulator-max-microvolt = <2950000>;

				bias-pull-down;
			};

			pm8921-l29 {
				compatible = "qcom,rpm-pm8921-pldo";
				reg = <QCOM_RPM_PM8921_L29>;

				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;

				bias-pull-down;
			};
		};

		gpio_keys {
			compatible = "gpio-keys";
			input-name = "gpio-keys";

			camera-focus {
				label = "camera_focus";
				gpios = <&pm8921_gpio 3 1>;
				linux,input-type = <1>;
				linux,code = <KEY_CAMERA_FOCUS>;
			};

			camera-snapshot {
				label = "camera_snapshot";
				gpios = <&pm8921_gpio 4 1>;
				linux,input-type = <1>;
				linux,code = <KEY_CAMERA>;
			};

			volume-down {
				label = "volume_down";
				gpios = <&pm8921_gpio 29 1>;
				linux,input-type = <1>;
				linux,code = <KEY_VOLUMEDOWN>;
			};

			volume-up {
				label = "volume_up";
				gpios = <&pm8921_gpio 35 1>;
				linux,input-type = <1>;
				linux,code = <KEY_VOLUMEUP>;
			};
		};
	};
};

&pm8921_gpio {
	pinctrl-0 = <&pm8921_gpio_default>;
	pinctrl-names = "default";

	pm8921_gpio_default: pm8921-gpio-default {
		camera-keys {
			pins = "gpio3", "gpio4";
			function = "normal";

			bias-pull-up;
			input-enable;
			drive-push-pull;
			drive-strength = <PM8XXX_GPIO_STRENGTH_NO>;
			power-source = <PM8XXX_GPIO_VIN_S4>;
		};

		volume-keys {
			pins = "gpio29", "gpio35";
			function = "normal";

			bias-pull-up;
			input-enable;
			drive-push-pull;
			drive-strength = <PM8XXX_GPIO_STRENGTH_NO>;
			power-source = <PM8XXX_GPIO_VIN_S4>;
		};
	};
};
